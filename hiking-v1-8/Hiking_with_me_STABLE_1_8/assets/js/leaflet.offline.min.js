/*!
 Leaflet.TileLayer.Offline, a JavaScript library for offline maps in Leaflet
 https://github.com/allartk/leaflet.offline
 built in 2018 by Arne Allart
*/
!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){
"use strict";var n=window.L;
i(1),i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),t.exports=n},function(t,e){
},function(t,e){
},function(t,e,i){
"use strict";var n=i(4);L.Control.SaveTiles=L.Control.extend({options:{position:"topleft",saveText:"Save",rmText:"Remove",maxZoom:19,zDirection:"up",zoomLevels:null,confirm:null,confirmRemoval:null},
initialize:function(t,e){L.setOptions(this,e),this._layer=t,this._map=null},
onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-control-savetiles leaflet-bar"),
i=L.DomUtil.create("a","save-button leaflet-bar-part",e),n=L.DomUtil.create("a","remove-button leaflet-bar-part",e);
return i.innerHTML=this.options.saveText,i.href="#",n.innerHTML=this.options.rmText,n.href="#",L.DomEvent.on(i,"click",this._saveTiles,this),L.DomEvent.on(n,"click",this._removeTiles,this),e},
onRemove:function(){},
_saveTiles:function(t){L.DomEvent.stop(t);var e=this.options.confirm;e?e(this._layer,function(){n.saveTiles(this._layer,this._map,this.options)}.bind(this)):n.saveTiles(this._layer,this._map,this.options)},
_removeTiles:function(t){L.DomEvent.stop(t);var e=this.options.confirmRemoval;e?e(this._layer,function(){n.removeTiles(this._layer,this._map,this.options)}.bind(this)):n.removeTiles(this._layer,this._map,this.options)}}),
L.control.savetiles=function(t,e){return new L.Control.SaveTiles(t,e)}},function(t,e,i){
"use strict";var n=i(5),r=i(6),o=i(7),a=i(8),s=i(9),l=function(t,e){return new Promise(function(n){t._url=a(t,e),r(t,e).then(function(e){s(e,n,t,e.length)})})},
u=function(t,e,i){return new Promise(function(n){l(t,e).then(function(t){o(t,i).then(n)})})};
t.exports.saveTiles=function(t,e,i){var r=i.zDirection,o=i.zoomLevels,a=i.maxZoom;if(!o)if("down"===r){o=[];for(var s=e.getZoom();s>=e.getMinZoom();)o.push(s),s--}else if("up"===r){o=[];for(var l=e.getZoom();l<=a;)o.push(l),l++}else o=[e.getZoom()];
for(var u=[],h=0;h<o.length;h++)for(var m=o[h],c=e.getPixelBounds(),f=e.getPixelOrigin(),p=c.min.divideBy(Math.pow(2,e.getZoom()-m)).floor(),d=c.max.divideBy(Math.pow(2,e.getZoom()-m)).floor(),v=[],g=p.y;g<=d.y;g++)for(var y=p.x;y<=d.x;y++){
var _={z:m,x:y,y:g,url:t.getTileUrl({x:y,y:g,z:m})};v.push(_)}
for(var w=0;w<v.length;w++)u.push(n(v[w]));return Promise.all(u)},t.exports.removeTiles=function(t,e,i){return o.remove(t,e,i)}},function(t,e,i){
"use strict";t.exports=function(t){return new Promise(function(e,i){var n=new XMLHttpRequest;n.open("GET",t.url),n.responseType="blob",n.onreadystatechange=function(){4===n.readyState&&(200===n.status?e({blob:n.response,x:t.x,y:t.y,z:t.z}):i({error:n.status,url:t.url}))},n.send()})}},function(t,e,i){
"use strict";function n(t){return(new Promise(function(i,n){var r=indexedDB.open("leafletOffline",1);r.onupgradeneeded=function(i){var n=i.target.result;try{n.createObjectStore("tiles",{keyPath:"id"})}catch(t){}},r.onerror=function(){n({error:"Cannot open indexedDB"})},r.onsuccess=function(){
var n=r.result,o=n.transaction(["tiles"],"readwrite"),a=o.objectStore("tiles"),s=t.z+"/"+t.x+"/"+t.y;a.put({id:s,data:t.blob});o.oncomplete=function(){i(!0)},o.onerror=function(){n.close(),i(!1)}}}))}n.remove=function(t,e,i){return new Promise(function(n,r){
var o=indexedDB.open("leafletOffline",1);o.onerror=function(){r({error:"Cannot open indexedDB"})},o.onsuccess=function(){var t=o.result,a=t.transaction(["tiles"],"readwrite"),s=a.objectStore("tiles");s.clear(),a.oncomplete=function(){n(!0)},a.onerror=function(){t.close(),r(!1)}}})},
t.exports=n},function(t,e,i){
"use strict";function n(t){return(new Promise(function(e,i){var n=indexedDB.open("leafletOffline",1);n.onerror=function(){i({error:"Cannot open indexedDB"})},n.onsuccess=function(){
var i=n.result,r=i.transaction(["tiles"],"readonly"),o=r.objectStore("tiles"),a=t.z+"/"+t.x+"/"+t.y,s=o.get(a);s.onsuccess=function(t){if(t.target.result){
var i=new Blob([t.target.result.data],{type:"image/png"});e({blob:i,x:t.target.result.x,y:t.target.result.y,z:t.target.result.z})}else e(!1)},s.onerror=function(){i.close(),e(!1)}}}))}n.remove=function(t,e,i){return new Promise(function(n,r){
var o=indexedDB.open("leafletOffline",1);o.onerror=function(){r({error:"Cannot open indexedDB"})},o.onsuccess=function(){
var t=o.result,a=t.transaction(["tiles"],"readwrite"),s=a.objectStore("tiles"),l=e.getPixelBounds(),u=e.getZoom();s.openCursor().onsuccess=function(i){
var n=i.target.result;if(!n)return;var r=n.key.split("/"),o=parseInt(r[2]),a=parseInt(r[1]),h=parseInt(r[0]);h===u&&a>=l.min.x&&a<=l.max.x&&o>=l.min.y&&o<=l.max.y&&s.delete(n.key),n.continue()},a.oncomplete=function(){n(!0)},a.onerror=function(){t.close(),r(!1)}}})},
t.exports=n},function(t,e,i){
"use strict";var n=function(t,e){return new Promise(function(i,n){var r=new FileReader;r.onloadend=function(){i(r.result)},r.onerror=function(t){n(t)},r.readAsDataURL(e.blob)})};t.exports=n},function(t,e,i){
"use strict";t.exports=function(t,e,i,n){for(var r=0;r<i.length;r++){
var o=i[r];
e(o.blob,function(r){
e(new Blob([r],{type:"image/png"}),function(a){
var s=new Image;s.onload=function(){t(n,a)},s.src=a}),r})}}}]);
